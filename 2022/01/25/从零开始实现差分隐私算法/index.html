<!DOCTYPE html><html lang="cn"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="丛零实现差分隐私（DP）"><meta name="keywords" content="DP"><meta name="author" content="WiKim"><meta name="copyright" content="WiKim"><title>丛零实现差分隐私（DP） | WiKim's Blog</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '5.4.0'
} </script><meta name="generator" content="Hexo 5.4.0"></head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#epsilon2probability"><span class="toc-number">1.</span> <span class="toc-text"> epsilon2probability</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#discretization"><span class="toc-number">2.</span> <span class="toc-text"> discretization</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#perturbation"><span class="toc-number">3.</span> <span class="toc-text"> perturbation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#random_response"><span class="toc-number">4.</span> <span class="toc-text"> random_response</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#random_response_adjust"><span class="toc-number">5.</span> <span class="toc-text"> random_response_adjust</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="http://aliyun-wkml.oss-cn-beijing.aliyuncs.com/img/image-20220125231602653.png"></div><div class="author-info__name text-center">WiKim</div><div class="author-info__description text-center">NLP+爬虫</div><div class="follow-button"><a target="_blank" rel="noopener" href="https://github.com/wkml">Follow Me</a></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">5</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">5</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(http://aliyun-wkml.oss-cn-beijing.aliyuncs.com/img/image-20220126005934337.png)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">WiKim's Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">丛零实现差分隐私（DP）</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-01-25</time><div class="post-meta-wordcount"><span>Word count: </span><span class="word-count">749</span><span class="post-meta__separator">|</span><span>Reading time: 2 min</span></div></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><p>DP最基本的一些操作。</p>
<span id="more"></span>
<p>基本的算法一般来说有以下几个：</p>
<ul>
<li>epsilon2probability(epsilon, n=2)</li>
<li>discretization(value, lower, upper)</li>
<li>perturbation(value, perturbed_value, epsilon)</li>
<li>random_response(value, epsilon)</li>
<li>random_response_adjust(sum, N, epsilon)</li>
</ul>
<h3 id="epsilon2probability"><a class="markdownIt-Anchor" href="#epsilon2probability"></a> epsilon2probability</h3>
<p>在Random Response中，我们的一个常见的需求，就是在给定 ε 的情况下如何知道用来表示维持原有数据的概率。数学上来看，对于二元回答{0, 1}，以概率p不变，以概率1-p翻转，其中，p的数学公式为：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle mathsize="2.488em"><mi>p</mi><mo>=</mo><mfrac><msup><mi>e</mi><mi>ϵ</mi></msup><mrow><msup><mi>e</mi><mi>ϵ</mi></msup><mo>+</mo><mn>1</mn></mrow></mfrac></mstyle></mrow><annotation encoding="application/x-tex">\Huge p=\frac{e^{\epsilon}}{e^{\epsilon}+1}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.555em;vertical-align:-0.48376672em;"></span><span class="mord mathdefault sizing reset-size6 size11">p</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel sizing reset-size6 size11">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:5.39459448em;vertical-align:-1.9140930400000002em;"></span><span class="mord sizing reset-size6 size11"><span class="mopen nulldelimiter sizing reset-size11 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.3989153697749197em;"><span style="top:-3.8019999999999996em;"><span class="pstrut" style="height:4.4879999999999995em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.6479153697749196em;"><span style="top:-4.3629999999999995em;margin-right:0.02009646302250804em;"><span class="pstrut" style="height:4.074em;"></span><span class="sizing reset-size11 size10 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">ϵ</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord">1</span></span></span><span style="top:-4.718em;"><span class="pstrut" style="height:4.4879999999999995em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-5.164999999999999em;"><span class="pstrut" style="height:4.4879999999999995em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.7219153697749197em;"><span style="top:-4.436999999999999em;margin-right:0.02009646302250804em;"><span class="pstrut" style="height:4.074em;"></span><span class="sizing reset-size11 size10 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">ϵ</span></span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.7693300000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size11 size6"></span></span></span></span></span></span></p>
<p>所以我们经常用到的一个算法就是根据 ε 计算概率p，代码如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">epsilon2probability</span>(<span class="params">epsilon, n=<span class="number">2</span></span>):</span></span><br><span class="line">    <span class="keyword">return</span> np.e ** epsilon / (np.e ** epsilon + n - <span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<h3 id="discretization"><a class="markdownIt-Anchor" href="#discretization"></a> discretization</h3>
<p>通常来说，现实生活中的数据可以认为是连续的，而我们经常需要把连续的数据进行离散化而又想维持数据的特点。比如希望数据离散化之后均值不变。</p>
<p>试想假如数据分布是0-100，现在有个数据是20，那么我们就以20%的概率输出0，以80%的概率输出1，这样可以保证期望不变。所以，假如我们想要将一个值value离散化到lower和upper，公式如下：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle mathsize="2.488em"><mi mathvariant="normal">Pr</mi><mo>⁡</mo><mo stretchy="false">[</mo><mtext> lower </mtext><mo stretchy="false">]</mo><mo>=</mo><mfrac><mrow><mtext> value </mtext><mo>−</mo><mtext> lower </mtext></mrow><mrow><mtext> upper </mtext><mo>−</mo><mtext> lower </mtext></mrow></mfrac></mstyle></mrow><annotation encoding="application/x-tex">\Huge \operatorname{Pr}[\text { lower }]=\frac{\text { value }-\text { lower }}{\text { upper }-\text { lower }}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.488em;vertical-align:-0.622em;"></span><span class="mop sizing reset-size6 size11"><span class="mord mathrm">P</span><span class="mord mathrm">r</span></span><span class="mopen sizing reset-size6 size11">[</span><span class="mord text sizing reset-size6 size11"><span class="mord"> lower </span></span><span class="mclose sizing reset-size6 size11">]</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel sizing reset-size6 size11">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:5.60267744em;vertical-align:-2.19053472em;"></span><span class="mord sizing reset-size6 size11"><span class="mopen nulldelimiter sizing reset-size11 size6"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.37144em;"><span style="top:-3.8019999999999996em;"><span class="pstrut" style="height:4.4879999999999995em;"></span><span class="mord"><span class="mord text"><span class="mord"> upper </span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord text"><span class="mord"> lower </span></span></span></span><span style="top:-4.718em;"><span class="pstrut" style="height:4.4879999999999995em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-5.165em;"><span class="pstrut" style="height:4.4879999999999995em;"></span><span class="mord"><span class="mord text"><span class="mord"> value </span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mord text"><span class="mord"> lower </span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.8804400000000001em;"><span></span></span></span></span></span><span class="mclose nulldelimiter sizing reset-size11 size6"></span></span></span></span></span></span></p>
<p>当然，这里说的是返回lower的概率，所以为了知道返回lower还是upper，我们产生一个[0,1]的随机数r，如果r&lt;p那么我们就返回lower即可。离散化的代码如下所示：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">discretization</span>(<span class="params">value, lower, upper</span>):</span></span><br><span class="line">    p = (value - lower) / (upper - lower)</span><br><span class="line">    rnd = np.random.random()</span><br><span class="line">    <span class="keyword">return</span> upper <span class="keyword">if</span> rnd &lt; p <span class="keyword">else</span> lower</span><br></pre></td></tr></table></figure>
<h3 id="perturbation"><a class="markdownIt-Anchor" href="#perturbation"></a> perturbation</h3>
<p>输入值A，值B和 ε ，以较大概率返回值A，以较小概率返回B，概率由 ε 控制，实际上，这就是最基本的random response了。所以先根据 ε 计算概率，然后再由概率控制输出哪个值。算法如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">perturbation</span>(<span class="params">value, perturbed_value, epsilon</span>):</span></span><br><span class="line">    p = epsilon2probability(epsilon)</span><br><span class="line">    rnd = np.random.random()</span><br><span class="line">    <span class="keyword">return</span> value <span class="keyword">if</span> rnd &lt; p <span class="keyword">else</span> perturbed_value</span><br></pre></td></tr></table></figure>
<h3 id="random_response"><a class="markdownIt-Anchor" href="#random_response"></a> random_response</h3>
<p>通常，random response针对的是01变量，而不是特殊的值，所以我们可以有perturbation再封装一个函数。为了防止错误使用，我加了一个筛选条件，如果不是01变量，那么会抛出一个异常。</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">random_response</span>(<span class="params">value, epsilon</span>):</span></span><br><span class="line">    <span class="keyword">if</span> value <span class="keyword">not</span> <span class="keyword">in</span> [<span class="number">0</span>, <span class="number">1</span>]:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&quot;ERROR&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> perturbation(value=value, perturbed_value=<span class="number">1</span>-value, epsilon=epsilon)</span><br></pre></td></tr></table></figure>
<h3 id="random_response_adjust"><a class="markdownIt-Anchor" href="#random_response_adjust"></a> random_response_adjust</h3>
<p>这个函数是用来对Random Response结果的反推，假如一共有N条数据，其中x个1，N-x个0，那么讲道理数据收集者应该收到多少个1呢？我们有这么个公式：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle mathsize="2.488em"><mi>M</mi><mo>=</mo><mi>x</mi><mo>⋅</mo><mi>p</mi><mo>+</mo><mo stretchy="false">(</mo><mi>N</mi><mo>−</mo><mi>x</mi><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>p</mi><mo stretchy="false">)</mo></mstyle></mrow><annotation encoding="application/x-tex">\Huge M=x \cdot p+(N-x)(1-p)
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.7001250399999999em;vertical-align:0em;"></span><span class="mord mathdefault sizing reset-size6 size11" style="margin-right:0.10903em;">M</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel sizing reset-size6 size11">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.1057916em;vertical-align:0em;"></span><span class="mord mathdefault sizing reset-size6 size11">x</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin sizing reset-size6 size11">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1.93509176em;vertical-align:-0.48376672em;"></span><span class="mord mathdefault sizing reset-size6 size11">p</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin sizing reset-size6 size11">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.488em;vertical-align:-0.622em;"></span><span class="mopen sizing reset-size6 size11">(</span><span class="mord mathdefault sizing reset-size6 size11" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin sizing reset-size6 size11">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.488em;vertical-align:-0.622em;"></span><span class="mord mathdefault sizing reset-size6 size11">x</span><span class="mclose sizing reset-size6 size11">)</span><span class="mopen sizing reset-size6 size11">(</span><span class="mord sizing reset-size6 size11">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin sizing reset-size6 size11">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:2.488em;vertical-align:-0.622em;"></span><span class="mord mathdefault sizing reset-size6 size11">p</span><span class="mclose sizing reset-size6 size11">)</span></span></span></span></span></p>
<p>所以对于收到的求和M我们可以根据这个公式估计出原来有多少个x，所以我把这个函数的名字取做Random response adjust，代码如下：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">random_response_adjust</span>(<span class="params"><span class="built_in">sum</span>, N, epsilon</span>):</span></span><br><span class="line">    p = epsilon2probability(epsilon)</span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">sum</span> + p*N - N) / (<span class="number">2</span>*p - <span class="number">1</span>)</span><br></pre></td></tr></table></figure>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">WiKim</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://wkml.github.io/2022/01/25/从零开始实现差分隐私算法/">https://wkml.github.io/2022/01/25/从零开始实现差分隐私算法/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/DP/">DP</a></div><nav id="pagination"><div class="next-post pull-right"><a href="/2022/01/25/%E7%88%AC%E5%8F%96%E5%AD%A6%E5%B0%8F%E6%98%93APP%E6%90%9C%E9%A2%98API/"><span>实战-requests+protobuf逆向爬取学小易APP搜题API</span><i class="fa fa-chevron-right"></i></a></div></nav><div id="vcomment"></div><script src="https://cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var notify = 'true' == 'true';
var verify = 'true' == 'true';
var record_ip = 'false' == 'true';
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  recordIP:record_ip,
  appId:'StIxiMKtozmPuIHapkJ7jNbk-gzGzoHsz',
  appKey:'eMvmCoAklkJSs3pxwG4UzsG5',
  placeholder:'发表你的友善见解OvO！（输入上面的邮箱可以收到别人对你最新回复哦！）',
  avatar:'wavatar',
  guest_info:guest_info,
  pageSize:'10',
  lang: 'zh-cn'
})</script></div></div><footer class="footer-bg" style="background-image: url(http://aliyun-wkml.oss-cn-beijing.aliyuncs.com/img/image-20220126005934337.png)"><div class="layout" id="footer"><div class="copyright">&copy;2021 - 2022 By WiKim</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="footer_custom_text">这里是wk的个人博客！</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css"><script src="/js/katex.js"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>